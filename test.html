<html>

<head>

</head>

<body>


<canvas id="canvas" width="800" height="800" style="border:solid 1px black"></canvas>


<script language="Javascript">

var canvas = document.getElementById("canvas").getContext("2d");
var interval = null;
canvas.strokeStyle='#AA0000';

var forms = Array();

function Component(){
   this.draw = function(){console.log("Not implemented");}
}

var largeur = 60;
var hauteur = 100;
var total = (largeur*9)/2;
var centre = 400;
var bordure = 20;

function CaseSpeciale(axe,titre){
   Component.apply(this);
   this.data = {};
   if(axe%2 == 1){ // E et 0
      // height et width inverse
      if(axe == 1){
         this.data.x = centre+total;
         this.data.y = centre + -4.5 * largeur - hauteur;
      }
      else{
         this.data.x = centre - total - hauteur;
         this.data.y = centre + 4.5 * largeur;
      }
   }
   else{ // N et S
      if(axe == 2){
         this.data.y = centre+total;
         this.data.x = centre + 4.5 * largeur;
      }
      else{
         this.data.y = centre - total - hauteur;
         this.data.x = centre - 4.5 * largeur - hauteur;
      }
   }
   this.data.height = this.data.width = hauteur;
   this.draw = function(){
      canvas.strokeStyle = '#000000';
      canvas.strokeRect(this.data.x,this.data.y,this.data.width,this.data.height);
      var lng = Math.max(0,(largeur - canvas.measureText(titre).width)) + 10;
      writeText(titre,this.data.x + lng,this.data.y +hauteur/2,0)
   }

}

function writeText(text,x,y,rotate){
    canvas.save();
    canvas.translate(x,y);
    canvas.rotate(rotate);
    canvas.font="9px Arial";
	 canvas.strokeText(text,0,0);
    canvas.restore();
}

function Case(pos,axe,color,title,prix){
   Component.apply(this);
   this.data = {};
   if(axe%2 == 1){ // E et 0
      // height et width inverse
      this.data.height = largeur;
      this.data.width = hauteur;
      if(axe == 1){
         this.data.x = centre+total;
         this.data.y = centre + (pos-5.5) * largeur;
      }
      else{
         this.data.x = centre - total - hauteur;
         this.data.y = centre + (4.5 - pos) * largeur;
      }
   }
   else{ // N et S
      this.data.height = hauteur;
      this.data.width = largeur;
      if(axe == 2){
         this.data.y = centre+total;
         this.data.x = centre + (4.5 - pos) * largeur;
      }
      else{
         this.data.y = centre - total - hauteur;
         this.data.x = centre + (pos - 5.5) * largeur;
      }
   }
   this.draw = function(){
      canvas.strokeStyle = '#000000';
      canvas.strokeRect(this.data.x,this.data.y,this.data.width,this.data.height);
      if(color != null){
          canvas.fillStyle = color;
          switch(axe){
             case 0 : canvas.fillRect(this.data.x,this.data.y+hauteur-bordure,this.data.width,bordure);break
             case 1 : canvas.fillRect(this.data.x,this.data.y,bordure,largeur);break
             case 2 : canvas.fillRect(this.data.x,this.data.y,this.data.width,bordure);break;
             case 3 : canvas.fillRect(this.data.x+hauteur-bordure,this.data.y,bordure,largeur);break
          }
      }
      if(title != null){
         var mots = [title];
         var width = canvas.measureText(title).width;
         if(width>largeur-5){
            mots = title.split(" ");
         }
         var pas = 15;
         
         for(var i = 0 ; i < mots.length ; i++){
             // On centre le texte
             var lng = Math.max(0,(largeur - canvas.measureText(mots[i]).width)) / 2;
             var dec = 15 + ((color!=null)?bordure:0);// Uniquement si couleur
             switch(axe){
                 case 0 : writeText(mots[i],this.data.x - lng+largeur,this.data.y+hauteur - dec - i*pas,Math.PI);break
                 case 1 : writeText(mots[i],this.data.x + dec + i*pas,this.data.y-lng+largeur,-Math.PI/2);break
                 case 2 : writeText(mots[i],this.data.x + lng,this.data.y + dec + i*pas,0);break;
                 case 3 : writeText(mots[i],this.data.x + hauteur - dec - i*pas,this.data.y + lng,Math.PI/2);;break
              }
         }
      }
      if(prix != null){
         var lng = Math.max(0,(largeur - canvas.measureText(prix).width)) / 2;
         var dec = 5
         if(axe == 0 && pos == 1)console.log((this.data.x - lng+largeur) + " " + (this.data.y) + " " + (-hauteur) + " " + dec)
         switch(axe){
             case 0 : writeText(prix,this.data.x - lng+largeur,this.data.y + dec,Math.PI);break
             case 1 : writeText(prix,this.data.x + hauteur - dec,this.data.y-lng+largeur,-Math.PI/2);break
             case 2 : writeText(prix,this.data.x + lng,this.data.y + hauteur - dec,0);break;
             case 3 : writeText(prix,this.data.x +dec,this.data.y + lng,Math.PI/2);;break
          }
      }
   }

}

function build(){
   setFrequency(100);
   addFillRect(0,0,800,800,'#A7E9DB');
    for(var axe = 0 ; axe< 4 ; axe++){
         addComponent(new CaseSpeciale(axe,["Parc gratuit","Prison","Depart","Simple visite"][axe]));
        for(var pos = 1 ; pos <= 9 ; pos++){
            addComponent(new Case(pos,axe,(pos%5==0)?null:(pos%2==0)?'#FF0000':'#0000FF',(pos%1==0)?"BLABLA test"+axe+" long"+pos:null,"F " + pos + "000"));
        }
    }
    
}

function Rect(data){
   this.data = data;
   this.draw = function(){
      canvas.strokeRect(this.data.x,this.data.y,this.data.width,this.data.height);
   }
}

function FillRect(data){
   this.data = data;
   this.draw = function(){
      canvas.fillStyle=data.color;
      canvas.fillRect(this.data.x,this.data.y,this.data.width,this.data.height);
   }
}

function addComponent(component){
   forms.push(component);
}

function addRect(x,y,width,height){
   forms.push(new Rect({x:x,y:y,width:width,height:height}));
}

function addFillRect(x,y,width,height,color){
   forms.push(new FillRect({x:x,y:y,width:width,height:height,color:color}));
}

// Rafraichit la fenetre
function setFrequency(time){
   if(interval!=null){
      clearInterval(interval);
   }
   interval = setInterval(refresh,time);
}

function clear(){
   canvas.clearRect(0,0,800,800);
}

function refresh(){
   clear();
   for(var i = 0 ; i < forms.length ; i++){
      forms[i].draw();
   }

}

build();

</script>

</body>


</html>
