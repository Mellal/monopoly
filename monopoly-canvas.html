    <!DOCTYPE html>
    <html>
	 <head>
	   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
	   <title>Monopoly</title>
	   <link type="text/css" href="css/sunny/jquery-ui-1.7.2.custom.css" rel="stylesheet" />	
	   <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
	   <script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>
	   <script type="text/javascript" src="monopoly.js"></script>
	   <style>
		.hypotheque {
            background-color: lightgrey;
            color:black;
		}		
	   </style>
		<link rel="stylesheet" type="text/css" href="style.css"/>
	  
		<body>
		
		<table><tr><td>
		<div style="width:1000px;height:1000px" id="plateau">
		<canvas id="canvas" width="870" height="870"></canvas>
		<canvas id="canvas_rt" width="870" height="870" style="top:0px;left:0px;position:absolute"></canvas>
		
		</div>
		</td>
		<td style="vertical-align:top">
	    
	   <div id="idDebug">
	   case : <input type="text" size="3" id="nb"/><input type="button" onclick="joueurCourant.joueDes(parseInt($('#nb').val()))" value="click"/><br/>
	   Goto : <input type="text" size="3" id="ide"/><input type="text" size="3" id="idp"/><input type="button" onclick="joueurCourant.pion.goto($('#ide').val(),$('#idp').val(),doActions)" value="goto"/><br/>
	   
	   
	   maison constructible : <input type="button" value="Chercher" onclick="construireMaisons()"/><br/>
	   Tableau de bord : <input type="button" value="Ouvrir" onclick="$('#housesPanel').dialog('open')"/><br/>
	   </div>
	   <div id="informations"></div>
	 
	   </td></tr></table>
	 
	   <div id="fiche" style="background-color:white;font-size:12px">
		<table style="width:250px;">
		  <tr><td></td><td>€</td></tr>
		  <tr><td>ACHAT</td><td id="achat" name="achat"></td></tr>
		  <tr><td>LOYER terrain nu</td><td id="loyer0"></td></tr>
		  <tr class="maison"><td> - 1 maison</td><td id="loyer1" name="loyer1"></td></tr>
		  <tr class="maison"><td> - 2 maisons</td><td id="loyer2" name="loyer2"></td></tr>
		  <tr class="maison"><td> - 3 maisons</td><td id="loyer3" name="loyer3"></td></tr>
		  <tr class="maison"><td> - 4 maisons</td><td id="loyer4" name="loyer4"></td></tr>
		  <tr class="maison"><td> - Hotel</td><td id="loyer5" name="loyer5"></td></tr>
		</table>
		<hr/>
		<div class="infos-group">
	   Si un joueur possède <span style="font-weight:bold">TOUS</span> les terrains d'un Groupe de Couleur quelconque,
	   le loyer des terrains nus de ce groupe est doublé.
		</div>
		<hr/>
		<div>
		Prix des Maisons  F <span id="prixMaison" name="prixMaison"></span> chacune<br/>
		Prix d'un Hôtel&nbsp; F <span id="prixHotel" name="prixMaison"></span> chacun<br/>
		</div>
		Valeur hypotécaire : Frs <span id="hypotheque" name="hypotheque"></span>
		
	   </div>
	   
	   <div id="ficheCompagnie" style="background-color:white">
		<br/>
		Si l'on possède UNE carte de compagnie de Service Public, le loyer est 400 fois le montant indiqué par les dés.<br/><br/>
		Si l'on possède les DEUX cartes de compagnies de Service Public, le loyer est MILLE fois le montant indiqué par les dés.<br/><br/>
		Valeur hypotécaire : Frs 7.500
	   </div>
	   
	   <div style="position:absolute;top:210px;left:320px;padding:5px;width:200px;height:80px;" class="ui-corner-all" id="informationsCentrale"></div>
	   <button style="position:absolute;top:260px;left:220px;" onclick="lancerAnimerDes()" id="idLancerDes">Lancez</button>
	   <div style="position:absolute;top:300px;left:200px;border:solid 1px black;border-radius:10px;width:230px;padding:5px" id="idMontantParc">
		Parc Gratuit : Frs <span></span>
	   </div>
	   
	   <div id="achatMaisons" style="background-color:white;"></div>
	   <div id="message" style="display:none;background-color:white"></div>
	 
	 	<div style="display:none" id="housesPanel">
	 	<div style="width:50%;height:calc(100% - 40px);background-color:lightblue;float:left">
	 		<div class="title-dialog">Hypotheque</div>
			<div id="idTerrainsHypotheques">
				Terrains hypothéqués<br/>
				<div>
				
				</div>
			</div>
			<hr/>
			<div id="idTerrains">
				Terrains hypothécables<br/>
				<select></select>
				<button id="idHypothequeAction">Hypothéquer</button>
				<div id="toHypotheque"></div>
			</div>			
	 	</div>
	 	<div style="width:50%;height:calc(100% - 40px);background-color:lightgreen;float:right">
	 		<div class="title-dialog">Constructions</div>
	 	</div>
		<div id="idTest" style="clear:both;width:100%;height:40px">
		  <table style="height:100%;width:100%;border:0;border-collapse: collapse"><tr>
		  <td style="width:37%;height:100%;background-color: lightblue;border-top:solid 1px lightblue;"></td>
		  <td style="width:26%;border:solid 1px black;padding:5px">
		    Resultat : <span id="idCoutTotal"></span><br/>
		    Porte-monnaie : <span id="idArgentRestant"></span>
		  </td>
		  <td style="width:37%;background-color: lightgreen;border-top:solid 1px lightgreen;"></td>
		  </tr></table>
		</div>
		
	 	</div>
	 
	 
	 
	   <script language="javascript">
		// On detecte le type de donnees a charger
		var plateau = "data-monopoly.json";
		if (location.href.indexOf("plateau=")!=-1) {
		  plateau = "data-monopoly-" + location.href.substring(location.href.indexOf("plateau=")+8) + ".json";
		}
		$(function(){
		  init(plateau);
		});
		
		var maisonsToHypo = [];
		var maisonsToLever = [];
		var cout = 0;
		$('#idHypothequeAction').click(function(){
			var terrain =  $('select > option:selected','#idTerrains');
			var fiche = terrain.data("fiche");
			maisonsToHypo[fiche.id] = fiche;
			var div = $('<div>' + fiche.nom + '</div>');
			var boutonAnnuler = $('<button style="margin-right:5px">Annuler</button>');
			boutonAnnuler.click(function(){
				addOption(fiche);
				$(this).parent().remove();
				cout-=fiche.hypotheque;
				updateCout();
				delete maisonsToHypo[fiche.id];
			});
			div.prepend(boutonAnnuler);
			$('#toHypotheque').append(div)
			$('select > option:selected','#idTerrains').remove();
			cout+=fiche.montantHypotheque;
			updateCout();
		});
		
		/* Valide le formulaire */
		function validerActions() {
			if(joueurCourant.montant+cout < 0){
				alert("Opération impossible : pas assez d'argent");
				return;
			}
		
		  // On recupere les fiches et on hypotheque les biens
		  for(var id in maisonsToHypo){
		    maisonsToHypo[id].hypotheque();
		  }
		  
		  // On recupere les fiches dont on leve l'hypotheque
		  for(var id in maisonsToLever){
		  	maisonsToLever[id].leveHypotheque();
		  }
		  $('#housesPanel').dialog('close');
		}
		
		function updateCout() {
		  $('#idCoutTotal').text(cout + " " + CURRENCY);
		  $('#idArgentRestant').text((joueurCourant.montant+cout) + " " + CURRENCY);
		}
		
		function addOption(fiche){
			var option = $("<option value='" + fiche.id + "'>" + fiche.nom + " (+" + fiche.montantHypotheque + " " + CURRENCY + ")</option>");
			option.data("fiche",fiche);			
			$('select','#idTerrains').append(option);
		}
		
		$('#housesPanel').dialog({
			width:800,
			height:600,
			title:'Gestion des maisons',
			modal:true,
			buttons:{'Fermer':function(){$('#housesPanel').dialog('close');},"Valider":validerActions},
			autoOpen:false,
			open:function(){
				maisonsToHypo=[];
				maisonsToLever=[];
				cout=0;
				$('select','#idTerrains').empty();
				$('#idTerrainsHypotheques > div').empty();
				$('#toHypotheque').empty();
				updateCout();
				// On charge les proprietes a hypothequer
				var proprietes = joueurCourant.findMaisonsHypothecables();
				
				$(proprietes).each(function(){
					addOption(this);
				});
				// On charge les proprietes hypothequees
				proprietes = joueurCourant.findMaisonsHypothequees();
				$(proprietes).each(function(){
					var fiche = this;
					var div = $("<div>" + this.nom + "</div>");
				  var boutonLever = $('<button style="margin-right:5px">Lever</button>');
					boutonLever.click(function(){
						$(this).attr('disabled','disabled');
						cout-=Math.round(fiche.montantHypotheque*1.1);
						maisonsToLever.push(fiche);
						updateCout();
					});
					div.prepend(boutonLever);
					 $('#idTerrainsHypotheques > div').append(div);
				});
			}
			
		});
		
	   </script>
	 
	 	 
		</body>
    </html>
