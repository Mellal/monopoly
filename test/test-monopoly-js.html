<html>
   <head>
      <title>Test Monopoly</title>
      <script language="javascript" src="../js/jquery-1.9.1.js">;</script>   
      <script language="Javascript" src="../js/qunit-1.12.0.js">;</script>
      <script language="Javascript" src="../monopoly.js">;</script>
      <link rel="stylesheet" type="text/css" href="../css/qunit-1.12.0.css"/>
            
            <script>
               
               test("Chargement plateau a vide",function(){
                  loadPlateau({});
                  equal(fiches.size(),0, "Fiches vide");
                  equal(cartesChance.size(),0, "Cartes chances vide");
                  equal(cartesCaisseCommunaute.size(),0,"Cartes caisse de communaute vide");                  
               });
               
               test("Chargement plateau avec des donnees incomplete",function(){
                  loadPlateau({
                     chance:{
                        cartes:[
                           {nom:"Carte 1",montant:10000},
                           {nom:"Carte 2",montant:-5000},
                           {nom:"Carte 3",montant:2000}
                        ]
                     },
                     communaute:{
                        cartes:[
                           {nom:"communaute 1",montant:1000},
                           {nom:"communaute 2",montant:-1000},
                           {nom:"communaute 3",montant:1000}
                        ]
                     }
                  });
                  equal(fiches.size(),0, "Fiches non chargees");
                  equal(cartesChance.size(),0, "Cartes chances chargees");
                  equal(cartesCaisseCommunaute.size(),0,"Cartes caisse de communaute chargees");                  
               });
			
			 test("Chargement plateau avec des donnees",function(){
                  loadPlateau({
                     chance:{
                        cartes:[
                           {nom:"Carte 1",type:"taxe",montant:10000},
                           {nom:"Carte 2",type:"taxe",montant:-5000},
                           {nom:"Carte 3",type:"taxe",montant:2000}
                        ]
                     },
                     communaute:{
                        cartes:[
                           {nom:"communaute 1",type:"taxe",montant:1000},
                           {nom:"communaute 2",type:"taxe",montant:-1000},
                           {nom:"communaute 3",type:"taxe",montant:1000}
                        ]
                     }
                  });
                  equal(fiches.size(),0, "Fiches non chargees");
                  equal(cartesChance.size(),3, "Cartes chances chargees");
                  equal(cartesCaisseCommunaute.size(),3,"Cartes caisse de communaute chargees");                  
               });
               
               test("Changement de joueur",function(){
                  des1=1;des2=2;
                  joueurs = [];
                  for (var i = 0 ; i < 5 ; i++) {
                     joueurs[i] =  new JoueurOrdinateur(i, "Joueur " + (i + 1));
                  }
                  joueurCourant = joueurs[0];
                  equal(joueurCourant.numero,0,"Joueur 1 selectionné");
                  equal(getNextJoueur().numero,1,"Joueur 2 selectionné");
                  joueurCourant = joueurs[1];
                  joueurCourant.bloque=true;
                  equal(getNextJoueur(),null,"Joueur 2 selectionné");
                  joueurCourant.bloque=false;
                  joueurs[2].defaite = true;
                  equal(getNextJoueur().numero,3,"Joueur 4 selectionné");
                  
               });
               
               test("Vainqueur du jeu",function(){
                  joueurs = [];
                  for (var i = 0 ; i < 3 ; i++) {
                     joueurs[i] =  new JoueurOrdinateur(i, "Joueur " + (i + 1));
                  }                  
                  joueurs[0].defaite = true;
                  joueurs[1].defaite = true;
                  joueurCourant = joueurs[0];
                  try{
                     getNextJoueur()
                     equal(1,2);
                  }catch(e){
                     equal(2,e.numero,"Vainqueur trouve");
                  }
                  //throws(getNextJoueur(),"Un joueur a gagné");
               });
               
               test("Paiement loyer",function(){
                  joueurs = [];
                  joueurs[0] = new JoueurOrdinateur(0,"Joueur 1");
                  joueurs[0].pion = {stats:{tour:0,prison:0}};
			   joueurs[0].div = $('');
                  joueurs[1] = new JoueurOrdinateur(0,"Joueur 2");
                  joueurs[1].pion = {stats:{tour:0,prison:0}};
                  joueurs[1].div = $('');
                  equal(joueurs[0].montant,100000,"Somme de départ J1");
                  equal(joueurs[1].montant,100000,"Somme de départ J2");
                  
                  equal(joueurs[0].getStats().argentDispo,100000,"Argent dispo J1");
                  // Achat maison
                  var maison = new Fiche(null, null, ["",""], "", "", 10000, [1000,2000,4000], 5000);
                  maison.vendu(joueurs[0]);
			   joueurs[0].payer(maison.achat);
                  equal(joueurs[0].montant,90000,"Achat propriete");
                  equal(joueurs[0].getStats().argentDispo,95000,"Achat propriete (argent dispo)");
			   
			   maison.nbMaison=2;
			   equal(joueurs[0].getStats().argentDispo,100000,"Achat 2 maisons");
			   joueurs[0].montant=2500;
			   equal(joueurs[0].getStats().argentDispo,12500,"Achat 2 maisons et argent a 2500");
			   joueurs[0].payerTo(15000,joueurs[1]);
			   equal(joueurs[0].defaite,true,"Defaite du joueur");
			   equal(joueurs[1].montant,112500,"Argent du joueur 2");
               });
               
			test("Constructions maison",function(){
			   joueurs = initJoueurs();
			   equal(true,true)                  
			   // On cree 2 groupes sur lesquels construire
			});
			
			test("Gestion prison",function(){
			   joueurs = initJoueurs();
			   fiches = [];
			   fiches[0] = new Fiche(null, null, ["#AAAAAA",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);			   
			   fiches[1] = new Fiche(null, null, ["#AAAAAA",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   fiches[2] = new Fiche(null, null, ["#AAABBB",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   fiches[3] = new Fiche(null, null, ["#AAABBB",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   fiches[4] = new Fiche(null, null, ["#AAABBB",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   fiches[5] = new Fiche(null, null, ["#CCCCCC",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   fiches[6] = new Fiche(null, null, ["#CCCCCC",""], "", "", 10000, [1000,2000,4000,8000,16000,25000], 5000);
			   
			   buyHouse(joueurs[1],0,5);
			   buyHouse(joueurs[1],1,5);			   
			   equal(joueurs[1].findGroupes().size(),1,"Joueur 1 possede un groupe");
			   
			   joueurs[0].enPrison=true;
			   equal(joueurs[0].getOutPrison(),true,"Pas de terrain ni de risque");
			   
			   buyHouse(joueurs[1],2,4);
			   buyHouse(joueurs[1],3,4);
			   buyHouse(joueurs[1],4,4);
			   equal(joueurs[0].getOutPrison(),false,"Terrain miné");
			   
			   joueurs[1].maisons = [];
			   fiches[0].joueurPossede = null;
			   fiches[1].joueurPossede = null;
			   fiches[2].joueurPossede = null;
			   fiches[3].joueurPossede = null;
			   fiches[4].joueurPossede = null;
			   
			});
						
			
			function buyHouse(joueur,index,nb){
			   fiches[index].joueurPossede = joueur;
			   joueur.maisons.push(fiches[index]);
			   fiches[index].nbMaison = nb;
			   if (nb == 5) {
				 fiches[index].hotel = true;
			   }
			}		  
			
			function initJoueurs() {
			   var joueurs = [];
			   joueurs[0] = new JoueurOrdinateur(0,"Joueur 1");
                  joueurs[0].pion = {stats:{tour:0,prison:0}};
			   joueurs[0].div = $('');
                  joueurs[1] = new JoueurOrdinateur(1,"Joueur 2");
                  joueurs[1].pion = {stats:{tour:0,prison:0}};
                  joueurs[1].div = $('');
			   return joueurs;
			}
			
            </script>
   </head>
   <body>
	 <a target="_blank" href="../monopoly-canvas.html">Lien jeu</a>      
      <div id="qunit"></div>
   </body>
   
</html>
